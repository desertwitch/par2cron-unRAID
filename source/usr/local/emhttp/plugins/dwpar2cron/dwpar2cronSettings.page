Menu="dwpar2cron:1"
Title="par2cron Settings"
Tag="sliders"
Markdown="false"
---
<?
/* Copyright Derek Macias (parts of code from NUT package)
 * Copyright macester (parts of code from NUT package)
 * Copyright gfjardim (parts of code from NUT package)
 * Copyright SimonF (parts of code from NUT package)
 * Copyright Dan Landon (parts of code from Web GUI)
 * Copyright Bergware International (parts of code from Web GUI)
 * Copyright Lime Technology (any and all other parts of Unraid)
 *
 * Copyright desertwitch (as author and maintainer of this file)
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License 2
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 */
require_once '/usr/local/emhttp/plugins/dwpar2cron/include/dwpar2cron_config.php';
require_once '/usr/local/emhttp/plugins/dwpar2cron/include/dwpar2cron_helpers.php';
?>

<form markdown="0" id="dwpar2cron-settings" name="dwpar2cron_settings" method="POST" action="/update.php" target="progressFrame">
    <input type="hidden" id="dwpar2cron-set-file" name="#file" value="dwpar2cron/dwpar2cron.cfg">
    <input type="hidden" id="dwpar2cron-set-cmd" name="#command" value="/usr/local/emhttp/plugins/dwpar2cron/scripts/write_config">

    <dl>
        <dt>par2cron:</dt>
        <dd>
            <strong><?= isset($dwpar2cron_binaries) && $dwpar2cron_binaries ? $dwpar2cron_binaries : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt>par2cron Backend:</dt>
        <dd>
            <strong><?= isset($dwpar2cron_backend) && $dwpar2cron_backend ? $dwpar2cron_backend : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt><strong>par2cron Schedule:</strong></dt>
        <dd>
            <select class="dwpar2cron-run" id="CRON" name="CRON" size="1">
                <?=mk_option($dwpar2cron_cron, "disable", "Never");?>
                <?=mk_option($dwpar2cron_cron, "hourly", "Hourly");?>
                <?=mk_option($dwpar2cron_cron, "daily", "Daily");?>
                <?=mk_option($dwpar2cron_cron, "weekly", "Weekly");?>
                <?=mk_option($dwpar2cron_cron, "monthly", "Monthly");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    <p>This setting controls how often par2cron should be executed.</p>
    </blockquote>

    <div id="CRONDOWSETTING">
        <dl>
            <dt>par2cron Schedule - Day of Week:</dt>
            <dd>
                <select class="dwpar2cron-run" id="CRONDOW" name="CRONDOW" size="1">
                    <?=mk_option($dwpar2cron_crondow, "0", "Sunday");?>
                    <?=mk_option($dwpar2cron_crondow, "1", "Monday");?>
                    <?=mk_option($dwpar2cron_crondow, "2", "Tuesday");?>
                    <?=mk_option($dwpar2cron_crondow, "3", "Wednesday");?>
                    <?=mk_option($dwpar2cron_crondow, "4", "Thursday");?>
                    <?=mk_option($dwpar2cron_crondow, "5", "Friday");?>
                    <?=mk_option($dwpar2cron_crondow, "6", "Saturday");?>
                </select>
            </dd>
        </dl>
    </div>

    <div id="CRONDOMSETTING">
        <dl>
            <dt>par2cron Schedule - Day of Month:</dt>
            <dd>
                <select class="dwpar2cron-run" id="CRONDOM" name="CRONDOM" size="1">
                    <?=dwpar2cron_dom_options($dwpar2cron_crondom);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>Beware that not all months of the year have more than 28 days.</p>
        </blockquote>
    </div>

    <div id="CRONHOURSETTING">
        <dl>
            <dt>par2cron Schedule - Hour:</dt>
            <dd>
                <select class="dwpar2cron-run" id="CRONHOUR" name="CRONHOUR" size="1">
                    <?=dwpar2cron_hour_options($dwpar2cron_cronhour);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>It is recommended to pick a time when ideally no other I/O (data transfer) operations are also running.</p>
        </blockquote>
    </div>

    <div id="CRONSETTINGS">
        <dl>
            <dt>par2cron Schedule - Start when Mover Running:</dt>
            <dd>
                <select class="dwpar2cron-run" id="MOVERSTART" name="MOVERSTART" size="1">
                    <?=mk_option($dwpar2cron_moverstart, "disable", "No");?>
                    <?=mk_option($dwpar2cron_moverstart, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When disabled, par2cron will not start when the OS mover is running.</p>
        </blockquote>

        <dl>
            <dt>par2cron Schedule - Start when Parity Running:</dt>
            <dd>
                <select class="dwpar2cron-run" id="PARITYSTART" name="PARITYSTART" size="1">
                    <?=mk_option($dwpar2cron_paritystart, "disable", "No");?>
                    <?=mk_option($dwpar2cron_paritystart, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When disabled, par2cron will not start when a parity operation is running.</p>
        </blockquote>

        <dl>
            <dt>par2cron Schedule - Create before Verify:</dt>
            <dd>
                <select class="dwpar2cron-run" id="INITAFTER" name="INITAFTER" size="1">
                    <?=mk_option($dwpar2cron_initafter, "disable", "No");?>
                    <?=mk_option($dwpar2cron_initafter, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled, par2cron will run a "create" operation before the "verify" operation.</p>
        <p>When disabled, you need to manually run any "create" operations from this page instead.</p>
        </blockquote>

        <dl>
            <dt>par2cron Schedule - Started Notifications:</dt>
            <dd>
                <select class="dwpar2cron-run" id="STARTNOTIFY" name="STARTNOTIFY" size="1">
                    <?=mk_option($dwpar2cron_startnotify, "disable", "No");?>
                    <?=mk_option($dwpar2cron_startnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when par2cron starts.</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>par2cron Schedule - Success Notifications:</dt>
            <dd>
                <select class="dwpar2cron-run" id="FINISHNOTIFY" name="FINISHNOTIFY" size="1">
                    <?=mk_option($dwpar2cron_finishnotify, "disable", "No");?>
                    <?=mk_option($dwpar2cron_finishnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when par2cron finishes with success.</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>par2cron Schedule - Failure Notifications:</dt>
            <dd>
                <select class="dwpar2cron-run" id="ERRORNOTIFY" name="ERRORNOTIFY" size="1">
                    <?=mk_option($dwpar2cron_errornotify, "disable", "No");?>
                    <?=mk_option($dwpar2cron_errornotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when par2cron encounters any failures (errors).</p>
        <p>This setting can be useful when <strong><em>Success Notifications</em></strong> are disabled and you want to be notified only of par2cron failures (errors).</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>
    </div>

    <dl>
        <dt>
            <span>
                <input id="RESETCONF" class="dwpar2cron-run dwpar2cron-tip" type="button" value="Reset Config" title="Reverts the whole configuration to its default state, including the program configuration.">
            </span>
        </dt>
        <dd>
            <span>
                <input type="submit" id="btnApply" name="#apply" value="Apply">
                <input type="button" value="Done" onclick="done()">
                <input id="DEFAULT" type="submit" class="dwpar2cron-run dwpar2cron-tip" name="#default" value="Default" title="Reverts the displayed settings to their default values, but not the program configuration.">
            </span>
        </dd>
    </dl>
</form>

<script>
function dwpar2cronCronSettings() {
    if ($("#CRON").val() === "hourly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "daily") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "weekly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").show();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "monthly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").show();
    } else {
        $("#CRONSETTINGS").hide();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    }
}
function dwpar2cronResetConfig() {
    $('#dwpar2cron-set-cmd').val('');
    openBox('/plugins/dwpar2cron/scripts/resetconf', 'par2cron Configuration Reset', 600, 600, true);
}
$(function() {
    showStatus('par2cron');

    dwpar2cronCronSettings();

    $("#CRON").change(dwpar2cronCronSettings);
    $('#RESETCONF').click(function(){ swal({title:"Are you sure?",text:"This action will return any existing configuration to their defaults!",type:"warning",html:true,showCancelButton:true}, dwpar2cronResetConfig); });

    $('.dwpar2cron-tip').tooltipster({
        maxWidth: 300
    });

    if ( typeof caPluginUpdateCheck === "function" ) {
        caPluginUpdateCheck("dwpar2cron.plg",{name:"par2cron"});
    }
});
</script>
